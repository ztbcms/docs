(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{438:function(t,a,e){"use strict";e.r(a);var s=e(44),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"自动登录授权"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自动登录授权"}},[t._v("#")]),t._v(" 自动登录授权")]),t._v(" "),e("blockquote",[e("p",[t._v("使用场景：用户在安卓APP中已经登录，此时需要访问一个用户已登录才能到达的web页面，我们期望安卓APP已登录的状态，可以无感登录(其实就是自动登录)进入到web页面(把安卓APP的登录状态携带到web网页中)")])]),t._v(" "),e("h3",{attrs:{id:"后台"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#后台"}},[t._v("#")]),t._v(" 后台")]),t._v(" "),e("ol",[e("li",[t._v("修改配置文件为前端自动登录页面\n"),e("img",{attrs:{src:"https://dn-coding-net-production-pp.qbox.me/e6812fb8-dfc5-4b0a-ac9e-fe4cf9c5ba8c.png",alt:"图片"}})]),t._v(" "),e("li",[t._v("修改APP登录接口\n"),e("img",{attrs:{src:"https://dn-coding-net-production-pp.qbox.me/efae2f8f-33e5-4f34-9a9e-0f993e8f0552.png",alt:"图片"}})])]),t._v(" "),e("h3",{attrs:{id:"前端-自动登录页面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端-自动登录页面"}},[t._v("#")]),t._v(" 前端 自动登录页面")]),t._v(" "),e("ol",[e("li",[t._v("获取url上的参数 login_code,redirect")]),t._v(" "),e("li",[t._v("调用接口 http://ztbcms.loc/Auth/AppLogin/loginByLoginCode")]),t._v(" "),e("li",[t._v("登录成功保存access_token,登录失败则不保存")]),t._v(" "),e("li",[t._v("跳转目标页redirect\n"),e("img",{attrs:{src:"https://dn-coding-net-production-pp.qbox.me/c37f5d97-07a9-4036-80b8-c846d31f5ebc.png",alt:"图片"}})])]),t._v(" "),e("h3",{attrs:{id:"app端-自动登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#app端-自动登录"}},[t._v("#")]),t._v(" APP端 自动登录")]),t._v(" "),e("ol",[e("li",[t._v("调用登录接口 http://ztbcms.loc/Auth/AppLogin/appLogin\n"),e("img",{attrs:{src:"https://dn-coding-net-production-pp.qbox.me/f47f956a-7f0b-4fde-ba0a-2e4dee7ec603.png",alt:"图片"}})]),t._v(" "),e("li",[t._v("缓存数据 userid,access_token,platform")]),t._v(" "),e("li",[t._v("签名，规则请看下面")]),t._v(" "),e("li",[t._v("构造自动登录链接")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("http://ztbcms.loc/Auth/AppLogin/loginRedirect?uid=1&timestamp=1527833183&platform=iOS&redirect=http%3a%2f%2fwww.zhutibang.cn&sign=27e5a7cf706d1a6c06133d8443ebdee6\n\nuid=xxx //用户ID，登陆接口中返回的user_id\ntimestamp=xxx //创建参数时的时间戳,单位:秒 10位数字，用于判断操作是否超时，目前默认5分钟后过期\nplatform=xxx //来自哪个平台，安卓端请填写 Android 苹果端请填写 iOS\nredirect= //跳转目标页，需要urlencode\nsign=xxx //参数签名，规则请看下面\n")])])]),e("ol",{attrs:{start:"5"}},[e("li",[t._v("跳转到此链接即可完成登录")])]),t._v(" "),e("h3",{attrs:{id:"签名规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#签名规则"}},[t._v("#")]),t._v(" 签名规则")]),t._v(" "),e("p",[t._v("假设传送的参数如下：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("uid：12\ntimestamp：1527488472\nplatform：iOS\nredirect：http%3a%2f%2fjingshui.front.ztbcms.cn%2f%23%2fcontrol\n")])])]),e("p",[t._v("第一步：对参数按照key=value的格式，并按照参数名ASCII字典序排序如下：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("platform=iOS&redirect=http%3A%2F%2Fjingshui.front.ztbcms.cn%2F%23%2Fcontrol&timestamp=1527488472&uid=12\n")])])]),e("p",[t._v("第二步：拼接access_token，access_token为登录接口返回")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("platform=iOS&redirect=http%3A%2F%2Fjingshui.front.ztbcms.cn%2F%23%2Fcontrol&timestamp=1527488472&uid=12&access_token=qydRzZEYq6bPiq58LdgpwoVLCjWAlh9MXiGNFpEGOADv4dXllZhVi7D0zvxNSwn2wlL8XhI5oUXquaP8iVLvErnvpStEAleeGvGTpATZRUhHYXA6DcKUhKCGhmA47hGv\n")])])]),e("p",[t._v("第三步：md5，获得签名")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("9583ca6d15af2987960e163a85299f21\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);